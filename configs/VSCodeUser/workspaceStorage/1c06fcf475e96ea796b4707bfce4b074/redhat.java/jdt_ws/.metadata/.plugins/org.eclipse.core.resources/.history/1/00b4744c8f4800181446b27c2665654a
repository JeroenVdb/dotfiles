package net.persgroep.app.gigyaoidc.web.interceptor;

import net.persgroep.app.gigyaoidc.service.OidcClientId;
import net.persgroep.app.gigyaoidc.web.model.OidcParameters;
import net.persgroep.app.gigyaoidc.web.view.CustomThymeleafViewResolver;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Component;
import org.springframework.web.servlet.handler.HandlerInterceptorAdapter;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

/**
 * Is being used by {@link CustomThymeleafViewResolver}
 */
@Component
public class ClientIdHandlerInterceptor extends HandlerInterceptorAdapter {

    private final OidcClientId oidcClientId;

    @Autowired
    public ClientIdHandlerInterceptor(final OidcClientId oidcClientId) {
        this.oidcClientId = oidcClientId;
    }

    @Override
    public boolean preHandle(final HttpServletRequest request, final HttpServletResponse response, final Object handler) throws Exception {
        String clientId = request.getParameter(OidcParameters.CLIENT_ID);
        if (clientId != null) {
            oidcClientId.setClientId(clientId);
        }
        return super.preHandle(request, response, handler);
    }
}
